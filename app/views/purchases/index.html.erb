<h1>Registro de compras</h1>
<% if !current_user.nil? && current_user.kind == 'Admin' %>
  <div class="col-md-2">
    <%= link_to 'Registrar compra', new_purchase_path, class: "btn btn-default btn-lg" %><br><br>
  </div>
<% end %>
  <div class="col-md-offset-8">
    <%= form_tag purchases_path, method: :get do %>
      <%= label_tag :kind, 'Filtro' %>
        <%= check_box_tag(:mes, 'yes') %>
        <%= label_tag("Mes") %>
        <%= select_date(Date.current, order: [:month,:year]) %>
      <%= submit_tag "Filtrar", name: nil, class: "btn btn-primary btn-md" %>
    <% end %>
  </div>
    <table class="table">
      <thead>
        <tr>
          <th><%= sortable "product_barcode", "CÃ³digo del producto" %></th>
          <th><%= sortable "provider_rut", "Rut proveedor" %></th>
          <th>Cantidad comprada</th>
          <th>Precio unitario</th>
          <th><%= sortable "created_at", "Fecha (AAAA-MM-DD)" %></th>
          <th colspan="3"></th>
        </tr>
      </thead>

      <tbody>
        <% @purchases.each do |purchase| %>
          <tr>
            <td><%= link_to purchase.product_barcode, Product.find_by_barcode(purchase.product_barcode) %></td>
            <td><%= link_to purchase.provider_rut, Provider.find_by_rut(purchase.provider_rut) %></td>
            <td><%= purchase.amount %></td>
            <td>$ <%= purchase.price %></td>
            <td><%= purchase.created_at.to_date %></td>
            <td><%= link_to 'Mostrar', purchase %></td>
            <td><%= link_to 'Editar', edit_purchase_path(purchase) %></td>
            <td><%= link_to 'Eliminar', purchase, method: :delete, data: { confirm: 'Seguro?' } %></td>
          </tr>
        <% end %>
      </tbody>
    </table>

<br>
