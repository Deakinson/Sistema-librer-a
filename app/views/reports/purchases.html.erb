<h1>Informe de compras</h1>
  <%= bootstrap_form_tag url: reports_purchases_path, method: :get, class: "form-inline" do |f| %>
    <div class="form-group form-inline">
      <%= f.label :date_filter, 'Año:' %>
      <%= select_year(Date.current, end_year: Date.current.year ) %>
      <%= submit_tag "Filtrar", name: nil, class: "btn btn-primary btn-md" %>
    </div>
  <% end %>
  <% if params[:date].present? %>
    <% if params[:date].present? %>
      <h2 align="center">Año: <%= params[:date]["year"] %></h2>
      <% @purchases = Purchase.where('extract(year from created_at) = ?',params[:date]['year']) %>
    <% end %>
    <table class="table">
      <%= render 'thead' %>
      <% suma = 0; ene = 0; feb = 0; mar = 0; abr = 0; may = 0; jun = 0; jul = 0; ago = 0; sep = 0; oct = 0; nov = 0; dic = 0 %>
      <% @purchases.each do |p| %>
        <% suma += (p.price*p.amount) %>
        <% ene += (p.price*p.amount) if p.created_at.to_date.month==1 %>
				<% feb += (p.price*p.amount) if p.created_at.to_date.month==2 %>
				<% mar += (p.price*p.amount) if p.created_at.to_date.month==3 %>
				<% abr += (p.price*p.amount) if p.created_at.to_date.month==4 %>
				<% may += (p.price*p.amount) if p.created_at.to_date.month==5 %>
				<% jun += (p.price*p.amount) if p.created_at.to_date.month==6 %>
				<% jul += (p.price*p.amount) if p.created_at.to_date.month==7 %>
				<% ago += (p.price*p.amount) if p.created_at.to_date.month==8 %>
				<% sep += (p.price*p.amount) if p.created_at.to_date.month==9 %>
				<% oct += (p.price*p.amount) if p.created_at.to_date.month==10 %>
				<% nov += (p.price*p.amount) if p.created_at.to_date.month==11 %>
				<% dic += (p.price*p.amount) if p.created_at.to_date.month==12 %>
      <% end %>
      <tbody>
        <% products = Purchase.group(:product_barcode) %>
        <% products.each do |p| %>
        <tr>
          <td><%= p.product_barcode %></td>
          <td>$ <%= ene %></td>
          <td>$ <%= feb %></td>
          <td>$ <%= mar %></td>
          <td>$ <%= abr %></td>
          <td>$ <%= may %></td>
          <td>$ <%= jun %></td>
          <td>$ <%= jul %></td>
          <td>$ <%= ago %></td>
          <td>$ <%= sep %></td>
          <td>$ <%= oct %></td>
          <td>$ <%= nov %></td>
          <td>$ <%= dic %></td>
          <td>$ <%= suma %></td>
        </tr>
        <% end %>
      </tbody>
    </table>
  <% end %>
